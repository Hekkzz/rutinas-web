<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tu Espacio Fitness | RutinasFit</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="navbar">
    <div class="logo">Rutinas<span>Fit</span></div>
    <button id="logoutBtn" class="btn small">Cerrar sesión</button>
  </header>

  <main class="user-page">
    <h2 id="welcomeText">Cargando usuario...</h2>
    <p>Aquí podrás generar y guardar tus rutinas personalizadas.</p>

    <div class="auth-box" style="margin: 2rem auto;">
      <h3 style="color:#00c896;">Generador rápido de rutina</h3>

      <div style="margin-top: 1rem;">
        <label>Objetivo:</label>
        <select id="objetivo" class="input-style">
          <option value="fuerza">Ganar músculo</option>
          <option value="perder">Perder grasa</option>
          <option value="mantener">Mantener</option>
        </select>
      </div>

      <div style="margin-top: 1rem;">
        <label>Nivel:</label>
        <select id="nivel" class="input-style">
          <option value="principiante">Principiante</option>
          <option value="intermedio">Intermedio</option>
        </select>
      </div>

      <button id="genRutina" class="btn" style="margin-top:1.5rem;">Generar y guardar rutina</button>
      <div id="rutinaOut" style="margin-top: 1.5rem;"></div>
    </div>
  </main>

  <footer>
    <p>© 2025 RutinasFit. Todos los derechos reservados.</p>
  </footer>

  <script type="module">
    import { auth, db } from "./firebase-config.js";
    import { onAuthStateChanged, signOut }
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { doc, setDoc }
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const logoutBtn = document.getElementById("logoutBtn");
    const welcomeText = document.getElementById("welcomeText");

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "login.html";
      } else {
        welcomeText.textContent = `Bienvenido, ${user.email}`;
      }
    });

    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "index.html";
    });

    const rutinas = {
      fuerza: { principiante: ["Sentadilla 3x12", "Flexiones 3x10"], intermedio: ["Sentadilla 4x8", "Press 4x6"] },
      perder: { principiante: ["HIIT 20min", "Circuito 3 rondas"], intermedio: ["HIIT 25min", "Circuito 4 rondas"] },
      mantener: { principiante: ["Cardio 30min", "Cuerpo completo 3 rondas"] }
    };

    document.getElementById("genRutina").addEventListener("click", async () => {
      const objetivo = document.getElementById("objetivo").value;
      const nivel = document.getElementById("nivel").value;
      const rutina = rutinas[objetivo][nivel] || ["Rutina no definida"];
      document.getElementById("rutinaOut").innerHTML =
        "<ul style='list-style:none; padding:0;'>" +
        rutina.map(r => `<li>✅ ${r}</li>`).join("") +
        "</ul>";

      const user = auth.currentUser;
      if (!user) return alert("Usuario no autenticado.");

      try {
        await setDoc(doc(db, "rutinas", user.uid), {
          email: user.email,
          fecha: new Date().toISOString(),
          objetivo, nivel, rutina
        });
        alert("Rutina guardada correctamente ✅");
      } catch (err) {
        console.error(err);
        alert("Error al guardar rutina: " + err.message);
      }
    });
  </script>
</body>

</html>
