<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mi Espacio | RutinasFit</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="navbar">
    <div class="logo">Rutinas<span>Fit</span></div>
    <button id="logoutBtn" class="btn small">Cerrar sesión</button>
  </header>

  <main class="user-page">
    <h2 id="welcomeText">Cargando usuario...</h2>
    <p>Genera y guarda tus rutinas personalizadas con IA.</p>

    <div class="auth-card" style="margin-top: 2rem;">
      <h3 style="color:#f5eedc;">Generar rutina rápida</h3>

      <div class="input-group">
        <label>Objetivo</label>
        <select id="objetivo" class="input-style">
          <option value="fuerza">Ganar músculo</option>
          <option value="perder">Perder grasa</option>
          <option value="mantener">Mantener forma</option>
        </select>
      </div>

      <div class="input-group">
        <label>Nivel</label>
        <select id="nivel" class="input-style">
          <option value="principiante">Principiante</option>
          <option value="intermedio">Intermedio</option>
        </select>
      </div>

      <button id="genRutina" class="btn" style="margin-top:1.5rem;">Generar y guardar</button>
      <div id="rutinaOut" style="margin-top: 1.5rem;"></div>
    </div>
  </main>

  <footer>
    <p>© 2025 RutinasFit | Tu asistente fitness inteligente</p>
  </footer>

  <script type="module">
    import { auth, db } from "./firebase-config.js";
    import { onAuthStateChanged, signOut }
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { doc, setDoc }
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const logoutBtn = document.getElementById("logoutBtn");
    const welcomeText = document.getElementById("welcomeText");

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
      } else {
        // Si tiene nombre registrado, lo mostramos
        const nombre = user.displayName || user.email;
        welcomeText.textContent = `Bienvenido, ${nombre}`;
      }
    });

    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
      window.location.href = "index.html";
    });

    const rutinas = {
      fuerza: { principiante: ["Sentadilla 3x12", "Flexiones 3x10"], intermedio: ["Press banca 4x8", "Dominadas 4x6"] },
      perder: { principiante: ["HIIT 20min", "Circuito 3 rondas"], intermedio: ["HIIT 25min", "Cardio 40min"] },
      mantener: { principiante: ["Full body 3x10", "Cinta 20min"], intermedio: ["Full body 4x8", "Bicicleta 30min"] }
    };

    document.getElementById("genRutina").addEventListener("click", async () => {
      const objetivo = objetivo.value;
      const nivel = nivel.value;
      const rutina = rutinas[objetivo][nivel] || ["Rutina no definida"];
      document.getElementById("rutinaOut").innerHTML =
        "<ul style='list-style:none;'>" +
        rutina.map(r => `<li>✅ ${r}</li>`).join("") +
        "</ul>";

      const user = auth.currentUser;
      if (!user) return alert("Usuario no autenticado");

      try {
        await setDoc(doc(db, "rutinas", user.uid), {
          email: user.email,
          fecha: new Date().toISOString(),
          objetivo, nivel, rutina
        });
        alert("Rutina guardada correctamente ✅");
      } catch (err) {
        alert("Error al guardar: " + err.message);
      }
    });
  </script>
</body>

</html>